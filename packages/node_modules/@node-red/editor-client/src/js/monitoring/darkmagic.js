RED.monitoring = (function () {

    function darkmagic() {
        // console.log("oiii2")
        // console.log(document.getElementById("2a9c68fe.30d878"))
        
        
        RED.nodes.eachNode(function(node) {

        var nodeElement = document.getElementById(node.id);
        var g = nodeElement.childNodes[1];
        var foreign = document.createElementNS('http://www.w3.org/2000/svg',"foreignObject");
        foreign.setAttribute('width', nodeElement.childNodes[0].getAttribute('width'));
        foreign.setAttribute('height',170);
        foreign.setAttribute('x',0);
        foreign.setAttribute('y',30);
        
        var iDiv = document.createElement('div');
        iDiv.innerHTML = '<div style="border:1px green solid;">Im a div inside a SVG.' +
        '<img src="https://media.makeameme.org/created/dark-magics-going.jpg" alt="Italian Trulli">' +
        '</div>';

        RED.comms.subscribe("monitoring/"+node.id, function (topic,event) {
            // console.log(event);
            // console.log(iDiv);
            iDiv.innerHTML = '<div style="border:1px green solid;">'+
            '<span>Value: '+ event.value.payload + '</span><br>' +
            '<span>Time: '+ new Date().toLocaleString() + '</span><br>' +
            '</div>';
        });


        
        foreign.appendChild(iDiv);
        g.appendChild(foreign);
        });
    };

    return {
        darkmagic
    }
})();